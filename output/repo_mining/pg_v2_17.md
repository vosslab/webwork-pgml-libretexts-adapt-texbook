# Mining Report: PG_v2.17

## Repo Overview

PG (Problem Generation) is the core Perl library that powers WeBWorK's problem authoring and rendering system. Version 2.17 (internally marked as 2.20 in the VERSION file, copyright 1996-2025) provides the complete macro framework, MathObject system, PGML parser, answer evaluators, and rendering pipeline that problem authors use to create interactive homework problems. PG is the language backbone that every `.pg` problem file depends on.

The repository is organized into a modular macro system with categorized subdirectories under `macros/`, a library of Perl modules under `lib/` for the MathObject/Parser framework, extensive POD documentation embedded in each macro file, 157 sample problems under `tutorial/sample-problems/`, and formal documentation in `doc/`. The architecture separates core functionality (PGML, MathObjects, answer checking) from domain-specific extensions (parsers, contexts, graph tools, UI elements).

## Directory Structure

| Directory | Description |
|---|---|
| `macros/core/` | Core macros: PGML.pl, MathObjects.pl, PGstandard.pl, scaffold.pl, PGgraders.pl, PGessaymacros.pl, RserveClient.pl, sage.pl |
| `macros/parsers/` | 30 parser macros for specialized answer types: RadioButtons, CheckboxList, PopUp, MultiAnswer, GraphTool, WordCompletion, etc. |
| `macros/contexts/` | 50 context macros defining specialized math environments: Fraction, Reaction, Boolean, BaseN, Percent, ScientificNotation, etc. |
| `macros/graph/` | 22 graphing macros: PGgraphmacros.pl, PGtikz.pl, PGlateximage.pl, parserGraphTool.pl, plotly3D.pl, etc. |
| `macros/ui/` | 12 UI macros: niceTables.pl, choiceUtils.pl, alignedChoice.pl, quickMatrixEntry.pl, etc. |
| `macros/math/` | 31 math-domain macros: draggableProof.pl, draggableSubsets.pl, MatrixReduce.pl, PGstatisticsmacros.pl, etc. |
| `macros/answers/` | 14 answer evaluation macros: answerHints.pl, weightedGrader.pl, answerCustom.pl, etc. |
| `macros/misc/` | 2 misc macros: randomPerson.pl, PCCmacros.pl |
| `macros/capa/` | 3 CAPA compatibility macros |
| `macros/deprecated/` | ~35 deprecated macros (legacy/compat) |
| `lib/` | Perl modules: Value.pm (MathObjects core), Parser.pm, Parser/ (parser classes), Value/ (value types), Units.pm, etc. |
| `lib/Value/` | MathObject value types: Real, Complex, Point, Vector, Matrix, Interval, Set, Union, Formula, String, List |
| `lib/Parser/` | Parser internals: Context, Function, BOP, UOP, Number, Variable, etc. |
| `doc/` | POD docs: UsingMathObjects.pod, MathObjectsAnswerCheckers.pod |
| `tutorial/sample-problems/` | 157 sample .pg files organized by topic (Algebra, Misc, ProblemTechniques, Statistics, etc.) |

## Macro Catalog

### Core Macros (`macros/core/`)

| File | Description |
|---|---|
| `PGstandard.pl` | Loads core PG macros (PG.pl, PGbasicmacros.pl, PGanswermacros.pl, PGauxiliaryFunctions.pl, customizeLaTeX.pl) |
| `MathObjects.pl` | Frontend to the MathObjects system (loads Parser.pl which loads Value.pl) |
| `PGML.pl` | The PGML parser - handles all PGML markup: answer blanks, math mode, formatting, lists, headings, code blocks, images, alignment |
| `scaffold.pl` | Multi-part scaffold problems where later parts are hidden until earlier parts are correct |
| `PGgraders.pl` | Grading strategies: full_partial_grader, custom_problem_grader_fluid, weighted scoring |
| `PGessaymacros.pl` | Essay answer boxes and manual grading: essay_cmp(), essay_box(), explanation_box() |
| `PGanswermacros.pl` | Core answer checking infrastructure |
| `PGbasicmacros.pl` | Core PG functions: image(), ans_rule(), BEGIN_TEXT, etc. |
| `PGauxiliaryFunctions.pl` | Math helper functions |
| `PGcommonFunctions.pl` | Common math functions for PG |
| `externalData.pl` | Store/retrieve data across problems: store_number_list(), store_string() |
| `RserveClient.pl` | R statistical computing integration |
| `sage.pl` | SageMath integration |
| `Parser.pl` | Parser infrastructure (loaded by MathObjects.pl) |
| `Value.pl` | Value/MathObject types (loaded by Parser.pl) |

### Parser Macros (`macros/parsers/`)

| File | Description |
|---|---|
| `parserRadioButtons.pl` | Radio button multiple choice with randomization, labels, values |
| `parserCheckboxList.pl` | Checkbox (select all that apply) with randomization, roman/ABC labels |
| `parserPopUp.pl` | Drop-down menus: PopUp(), DropDown(), DropDownTF() with placeholder support |
| `parserMultipleChoice.pl` | Meta-loader for PopUp + CheckboxList + RadioButtons + RadioMultiAnswer |
| `parserRadioMultiAnswer.pl` | Radio buttons with dependent answer blanks per choice |
| `parserMultiAnswer.pl` | Multiple interdependent answer blanks with custom checker |
| `parserOneOf.pl` | Accept any one of several correct answers: OneOf(pi, "2x+1") |
| `parserWordCompletion.pl` | Autocomplete text input with datalist suggestions |
| `parserNumberWithUnits.pl` | Numbers with physical units: NumberWithUnits("3 ft"), custom units supported |
| `parserFormulaWithUnits.pl` | Formulas with units: FormulaWithUnits("3x+1 ft") |
| `parserFormulaUpToConstant.pl` | Formulas up to an additive constant (for indefinite integrals) |
| `parserFormulaAnyVar.pl` | Formulas accepting any variable |
| `parserDifferenceQuotient.pl` | Difference quotient expressions |
| `parserAssignment.pl` | Assignment expressions like y = mx + b |
| `parserImplicitEquation.pl` | Implicit equations like x^2 + y^2 = 1 |
| `parserImplicitPlane.pl` | Implicit plane equations |
| `parserLinearInequality.pl` | Linear inequalities |
| `parserLinearRelation.pl` | Linear relations |
| `parserParametricLine.pl` | Parametric line representations |
| `parserParametricPlane.pl` | Parametric plane representations |
| `parserFunction.pl` | Custom function definitions |
| `parserFunctionPrime.pl` | Functions with prime notation (f'(x)) |
| `parserSolutionFor.pl` | Solutions to equations |
| `parserVectorUtils.pl` | Vector utility functions |
| `parserCustomization.pl` | Parser customization utilities |
| `parserAutoStrings.pl` | Auto-detect string answers |
| `parserQuotedString.pl` | Quoted string answers |
| `parserPrime.pl` | Prime number/notation parsing |
| `parserRoot.pl` | Root/radical expressions |
| `parserLogb.pl` | Logarithm base notation |
| `parserGraphTool.pl` | Interactive graphing tool for student input (lines, circles, parabolas, intervals, fills, etc.) |

### Context Macros (`macros/contexts/`)

| File | Description |
|---|---|
| `contextFraction.pl` | Fraction contexts: Fraction, Fraction-NoDecimals, LimitedFraction, LimitedProperFraction |
| `contextReaction.pl` | Chemical reaction equations with ions, states, complexes |
| `contextBoolean.pl` | Boolean logic expressions with AND, OR, XOR, NOT operators |
| `contextBaseN.pl` | Non-decimal base arithmetic (binary, octal, hex, base64, custom) |
| `contextPercent.pl` | Percentage values with %, multiple strictness levels |
| `contextScientificNotation.pl` | Scientific notation with configurable significant digits |
| `contextOrdering.pl` | Ordered lists like "B > A = C > D" |
| `contextCurrency.pl` | Currency values |
| `contextInequalities.pl` | Inequality expressions |
| `contextInequalitySetBuilder.pl` | Set-builder notation with inequalities |
| `contextInteger.pl` | Integer-only context |
| `contextIntegerFunctions.pl` | Integer functions |
| `contextLimitedNumeric.pl` | Restricted numeric input |
| `contextLimitedFactor.pl` | Factored polynomial form only |
| `contextLimitedPolynomial.pl` | Polynomial form only |
| `contextLimitedRadical.pl` | Radical/root form only |
| `contextLimitedComplex.pl` | Limited complex number operations |
| `contextLimitedPoint.pl` | Limited point operations |
| `contextLimitedVector.pl` | Limited vector operations |
| `contextLimitedPowers.pl` | Restricted exponent usage |
| `contextPiecewiseFunction.pl` | Piecewise function definitions |
| `contextPolynomialFactors.pl` | Polynomial in factored form |
| `contextRationalFunction.pl` | Rational function context |
| `contextRationalExponent.pl` | Rational exponents |
| `contextTrigDegrees.pl` | Trig functions using degrees |
| `contextString.pl` | String context |
| `contextArbitraryString.pl` | Accept any string input |
| `contextTF.pl` | True/False context |
| `contextABCD.pl` | Letter-choice context (A, B, C, D) |
| `contextUnits.pl` | Physical units context |
| `contextAlternateDecimal.pl` | Alternate decimal notation (comma vs period) |
| `contextAlternateIntervals.pl` | Alternate interval notation |
| `contextComplexExtras.pl` | Extended complex number operations |
| `contextComplexJ.pl` | Complex numbers using j instead of i |
| `contextCongruence.pl` | Modular arithmetic |
| `contextExtensions.pl` | Context extension utilities |
| `contextFiniteSolutionSets.pl` | Finite solution sets |
| `contextForm.pl` | Form context |
| `contextFunctionAssign.pl` | Function assignment notation |
| `contextLeadingZero.pl` | Enforce leading zeros in decimals |
| `contextMatrixExtras.pl` | Extended matrix operations |
| `contextPartition.pl` | Partition context |
| `contextPercent.pl` | Percentage context |
| `contextPermutation.pl` | Permutation notation |
| `contextPermutationUBC.pl` | UBC permutation notation |
| `contextRestrictedDomains.pl` | Formulas with restricted domains |
| `contextTypeset.pl` | Typesetting context |

### Graphing Macros (`macros/graph/`)

| File | Description |
|---|---|
| `PGgraphmacros.pl` | Core graphing: init_graph(), add_functions(), Fun objects, Labels, Circles |
| `PGtikz.pl` | TikZ image generation: createTikZImage(), tikzLibraries, tikzOptions |
| `PGlateximage.pl` | General LaTeX image generation: createLaTeXImage() |
| `parserGraphTool.pl` | Interactive JS graphing: points, lines, circles, parabolas, quadratics, cubics, intervals, sine waves, triangles, quadrilaterals, segments, vectors, fills |
| `plotly3D.pl` | 3D plotting with Plotly.js: Graph3D(), addCurve(), addFunction(), addSurface() |
| `PGgraphgrid.pl` | Graph grid utilities |
| `PCCgraphMacros.pl` | PCC-style graph macros |
| `PGnauGraphics.pl` | NAU graphics macros |
| `PGstatisticsGraphMacros.pl` | Statistics graphing macros |
| `PGanalyzeGraph.pl` | Graph analysis utilities |
| `imageChoice.pl` | Image-based matching questions |
| `plots.pl` | Plot utilities |
| `unionImage.pl` | Image display utilities |
| `VectorField2D.pl` | 2D vector field plots |
| `AppletObjects.pl` | Java/Flash applet embedding |
| `LiveGraphics3D.pl` | Interactive 3D graphics |
| `LiveGraphicsCylindricalPlot3D.pl` | 3D cylindrical plots |
| `LiveGraphicsParametricCurve3D.pl` | 3D parametric curves |
| `LiveGraphicsParametricSurface3D.pl` | 3D parametric surfaces |
| `LiveGraphicsRectangularPlot3D.pl` | 3D rectangular plots |
| `LiveGraphicsVectorField2D.pl` | 2D vector field visualization |
| `LiveGraphicsVectorField3D.pl` | 3D vector field visualization |

### UI Macros (`macros/ui/`)

| File | Description |
|---|---|
| `niceTables.pl` | Accessible tables: DataTable() and LayoutTable() with CSS/LaTeX styling, column alignment, cell options, headers |
| `pccTables.pl` | PCC-style tables |
| `PGchoicemacros.pl` | Choice/matching question infrastructure |
| `choiceUtils.pl` | Choice display utilities |
| `alignedChoice.pl` | Aligned choice display |
| `quickMatrixEntry.pl` | Quick matrix input interface |
| `PGinfo.pl` | Problem information display |
| `problemPanic.pl` | Panic button for hints |
| `source.pl` | Source code display |
| `text2PG.pl` | Text to PG conversion |
| `unionLists.pl` | List display utilities |
| `unionTables.pl` | Table display utilities |

### Math-Domain Macros (`macros/math/`)

| File | Description |
|---|---|
| `draggableProof.pl` | Drag-and-drop proof ordering with Levenshtein/Damerau-Levenshtein scoring |
| `draggableSubsets.pl` | Drag-and-drop set partitioning into buckets |
| `MatrixReduce.pl` | Matrix row reduction operations |
| `MatrixCheckers.pl` | Matrix answer checkers |
| `MatrixUnits.pl` | Unit matrix generators |
| `MatrixUnimodular.pl` | Unimodular matrix tools |
| `PGstatisticsmacros.pl` | Statistics functions |
| `PGnumericalmacros.pl` | Numerical methods |
| `PGpolynomialmacros.pl` | Polynomial operations |
| `PGdiffeqmacros.pl` | Differential equations |
| `LinearProgramming.pl` | Linear programming |
| `tableau.pl` | Simplex tableaux |
| `bizarroArithmetic.pl` | Modified arithmetic for forcing specific answer forms |
| `fixedPrecision.pl` | Fixed-precision decimal answers |
| `specialTrigValues.pl` | Special trig value recognition |
| `algebraMacros.pl` | Algebra helper macros |
| `customizeLaTeX.pl` | LaTeX output customization |
| `interpMacros.pl` | Interpolation macros |
| `PCCfactor.pl` | PCC factoring utilities |
| `VectorListCheckers.pl` | Vector list answer checking |
| `SolveLinearEquationPCC.pl` | Linear equation solving (PCC) |
| `SystemsOfLinearEquationsProblemPCC.pl` | Systems of linear equations (PCC) |
| `PGnauGraphtheory.pl` | Graph theory |
| `PGnauBinpacking.pl` | Bin packing algorithms |
| `PGnauScheduling.pl` | Scheduling algorithms |
| `PGnauSet.pl` | Set operations |
| `PGnauStats.pl` | NAU statistics |
| `PGnauGraphCatalog.pl` | Graph catalog |
| `SI_property_tables.pl` | SI unit property tables |

### Answer Evaluation Macros (`macros/answers/`)

| File | Description |
|---|---|
| `answerHints.pl` | Post-filter for targeted error messages based on specific wrong answers |
| `answerCustom.pl` | Custom answer checker creation |
| `weightedGrader.pl` | Weighted scoring (now integrated into avg_problem_grader) |
| `unorderedAnswer.pl` | Accept answers in any order |
| `extraAnswerEvaluators.pl` | Additional answer evaluators |
| `ConditionalHint.pl` | Conditional hint display |
| `answerComposition.pl` | Function composition checking |
| `answerVariableList.pl` | Variable list answers |
| `Generic.pl` | Generic answer evaluation |
| `PGasu.pl` | ASU-specific evaluators |
| `PGfunctionevaluators.pl` | Function evaluators |
| `PGnumericevaluators.pl` | Numeric evaluators |
| `PGstringevaluators.pl` | String evaluators |
| `PGmiscevaluators.pl` | Misc evaluators |

### Misc Macros (`macros/misc/`)

| File | Description |
|---|---|
| `randomPerson.pl` | Random person names with correct pronouns (he/she/they), verb conjugation, diverse name database from SSA/Census data |
| `PCCmacros.pl` | PCC (Portland Community College) utility macros |

## Chapter Mapping

### Chapter 1: Introduction (WeBWorK basics)
- **Relevant files**: `README.md`, `macros/core/PGstandard.pl`
- **What to extract**: Overview of PG system, what PGstandard loads, philosophy of macro system
- **Example snippets**:
```perl
# PGstandard.pl loads these five core macros:
loadMacros("PG.pl", "PGbasicmacros.pl", "PGanswermacros.pl",
           "PGauxiliaryFunctions.pl", "customizeLaTeX.pl");
```
- **Textbook gap it fills**: Explains what happens behind `loadMacros('PGstandard.pl', 'PGML.pl')` -- the loading chain

### Chapter 2: Problem Generation PG (KEY CHAPTER)
- **Relevant files**: `macros/core/MathObjects.pl`, `lib/Value.pm`, `lib/Parser.pm`, `doc/UsingMathObjects.pod`, `doc/MathObjectsAnswerCheckers.pod`, all `macros/contexts/*.pl`, `macros/core/PGbasicmacros.pl`
- **What to extract**: Complete MathObject type system (Real, Complex, Point, Vector, Matrix, Interval, Set, Union, Formula, String, List), Context system, answer checker creation via `->cmp()`, tolerance/flag settings, `Compute()` vs type constructors, formula manipulation (eval, reduce, substitute, TeX, string)
- **Example snippets**:
```perl
# MathObject types and answer checking
Context("Numeric");
$f = Formula("x^2 + 3x + 1");
$ans = $f->eval(x => 5);      # evaluate
$tex = $f->TeX;                 # LaTeX output
$reduced = $f->reduce;          # simplify
ANS($f->cmp);                  # answer checker

# Context flags control tolerance
Context()->flags->set(
    tolerance    => 1E-4,
    tolType      => 'relative',
    zeroLevel    => 1E-14,
    zeroLevelTol => 1E-12,
);
```
- **Textbook gap it fills**: Deep documentation of Context system, all MathObject types, the full `->cmp()` options catalog

### Chapter 3: PGML
- **Relevant files**: `macros/core/PGML.pl`
- **What to extract**: PGML syntax details from parser -- answer blanks (`[_]{$ans}`, `[_]{$ans}{width}`, `[_]*` for arrays), math mode (`[` `` ` `` `]` and `[` `` `` `` `]`), bold/italic (`*text*`, `**text**`), headings (`#`, `##`), lists (bullet `-`, numbered `1.`), code blocks (` ``` `), preformatted (`:   `), alignment (`>>`, `<<`), images (`[!alt!]{url}`), command substitution (`[@ perl @]`, `[@ perl @]*`, `[@ perl @]***`), variable substitution (`[$var]`), line breaks (three trailing spaces), rules (`---`, `===`)
- **Example snippets**:
```
# PGML answer blank syntax variants:
[_]{$answer}           # basic answer blank
[_]{$answer}{20}       # answer blank with width 20
[____]{$answer}        # wider answer blank (width = underscore count)
[_]*{$answer}          # answer array (for matrices)
[^]{$radio}            # radio button answer (checkbox)
[o]{$popup}            # popup/dropdown answer

# PGML formatting:
*italic* **bold** ***bold italic***
[`math inline`]  [``display math``]
[@ $perl_code @]*   # execute Perl, render as HTML
[@ $perl_code @]*** # execute Perl, render processed through LaTeX
```
- **Textbook gap it fills**: Complete PGML syntax reference derived from the parser source code (the regex patterns define the grammar)

### Chapter 4: Breaking Down Components
- **Relevant files**: `tutorial/sample-problems/Misc/MultipleChoiceRadio.pg` (exemplar), all `tutorial/sample-problems/**/*.pg`
- **What to extract**: Full problem file anatomy demonstrated in 157 sample problems: OPL header tags (`DBsubject`, `DBchapter`, etc.), DOCUMENT()/ENDDOCUMENT() wrapper, loadMacros(), setup section, BEGIN_PGML/END_PGML, BEGIN_PGML_SOLUTION/END_PGML_SOLUTION, ANS() calls
- **Example snippets**:
```perl
## DBsubject(WeBWorK)
## DBchapter(WeBWorK tutorial)
## DBsection(PGML tutorial 2015)
## KEYWORDS('multiple choice', 'template')

DOCUMENT();
loadMacros('PGstandard.pl', 'PGML.pl', 'parserRadioButtons.pl', 'PGcourse.pl');

# Setup
$radio = RadioButtons([['Red', 'Blue', 'Green'], 'None of these'], 'Blue');

# Statement
BEGIN_PGML
My favorite color is
[_]{$radio}
END_PGML

# Solution
BEGIN_PGML_SOLUTION
The correct answer is [$radio->correct_ans].
END_PGML_SOLUTION

ENDDOCUMENT();
```
- **Textbook gap it fills**: Canonical file structure with modern PGML patterns vs legacy BEGIN_TEXT

### Chapter 5: Different Question Types
- **Relevant files**: `macros/parsers/parserRadioButtons.pl`, `macros/parsers/parserCheckboxList.pl`, `macros/parsers/parserPopUp.pl`, `macros/parsers/parserMultiAnswer.pl`, `macros/parsers/parserRadioMultiAnswer.pl`, `macros/parsers/parserOneOf.pl`, `macros/parsers/parserWordCompletion.pl`, `macros/parsers/parserNumberWithUnits.pl`, `macros/parsers/parserFormulaWithUnits.pl`, `macros/math/draggableProof.pl`, `macros/math/draggableSubsets.pl`, `macros/core/PGessaymacros.pl`, `macros/core/scaffold.pl`, `macros/ui/PGchoicemacros.pl`
- **What to extract**: Complete documentation for every question type -- RadioButtons (randomization groups, labels, values, displayLabels, separator), CheckboxList (multi-select, labels: ABC/123/roman), DropDown/PopUp/DropDownTF (placeholder, useHTMLSelect, showInStatic), MultiAnswer (singleResult, custom checker, partialCredit), RadioMultiAnswer (radio-dependent answer blanks), OneOf (multiple correct answers), WordCompletion (autocomplete), DraggableProof (ordered drag-and-drop), DraggableSubsets (partitioning), essay_cmp/essay_box, scaffold sections
- **Example snippets**:
```perl
# CheckboxList with randomized choices and labeled output
$checks = CheckboxList(
    [
        "First item (always on top)",
        ["Random 1", "Random 2", "Random 3"],
        "Last item (always on bottom)"
    ],
    ["First item (always on top)", "Random 3"],
    labels => "ABC",
);

# MultiAnswer with custom checker
$ma = MultiAnswer($f, $g)->with(
    singleResult => 1,
    checker => sub {
        my ($correct, $student, $self) = @_;
        my ($f_stu, $g_stu) = @$student;
        return ($f_stu == $$correct[0] && $g_stu == $$correct[1]) ? 1 : 0;
    }
);
```
- **Textbook gap it fills**: DraggableProof/DraggableSubsets (not documented), RadioMultiAnswer (not documented), WordCompletion (not documented), OneOf (not documented), detailed MultiAnswer custom checkers

### Chapter 6: Advanced PGML (KEY CHAPTER)
- **Relevant files**: `macros/ui/niceTables.pl`, `macros/graph/PGgraphmacros.pl`, `macros/graph/PGtikz.pl`, `macros/graph/PGlateximage.pl`, `macros/graph/parserGraphTool.pl`, `macros/graph/plotly3D.pl`, `macros/contexts/contextReaction.pl`, `macros/contexts/contextBoolean.pl`, `macros/contexts/contextBaseN.pl`, `macros/contexts/contextFraction.pl`, `macros/contexts/contextScientificNotation.pl`, `macros/contexts/contextPercent.pl`, `macros/contexts/contextOrdering.pl`, `macros/answers/answerHints.pl`, `macros/misc/randomPerson.pl`, `macros/math/bizarroArithmetic.pl`
- **What to extract**: niceTables DataTable/LayoutTable options (texalignment, horizontalrules, caption, encase, rowheaders, CSS/LaTeX styling), TikZ image creation, LaTeX image creation, GraphTool interactive graphing, plotly3D for 3D plots, chemical Reaction context, Boolean context, BaseN context, answer hints for targeted feedback, randomPerson for inclusive problem writing
- **Example snippets**:
```perl
# niceTables DataTable with full options
DataTable(
    [
        [["Header 1", header => 'ch'], ["Header 2", header => 'ch']],
        ['data1', 'data2'],
        ['data3', 'data4'],
    ],
    align           => '|l|c|',
    horizontalrules => 1,
    caption         => 'My Table',
    center          => 1,
);

# TikZ image creation
$image = createTikZImage();
$image->tikzLibraries("arrows.meta,calc");
$image->BEGIN_TIKZ
\draw (-2,0) -- (2,0);
\draw (0,-2) -- (0,2);
\draw (0,0) circle[radius=1.5];
END_TIKZ
# Insert: image(insertGraph($image))
```
- **Textbook gap it fills**: plotly3D (3D graphing not covered), GraphTool interactive graphing, contextReaction for chemistry, contextBoolean for logic, contextBaseN for CS, randomPerson for DEI, comprehensive niceTables options

### Chapter 7: Testing and Debugging
- **Relevant files**: `macros/core/PGgraders.pl`, `macros/answers/answerHints.pl`, `macros/answers/weightedGrader.pl`
- **What to extract**: Grading strategies (full_partial_grader, custom_problem_grader_fluid), AnswerHints post-filter for targeted error messages, weighted grading
- **Example snippets**:
```perl
# AnswerHints for targeted feedback
ANS(Real(sqrt(2))->cmp->withPostFilter(AnswerHints(
    0     => ["The answer is not zero"],
    sub {
        my ($correct, $student, $ans) = @_;
        return abs($student - $correct) < 0.1;
    } => "You're close! Check your calculation.",
)));
```
- **Textbook gap it fills**: Custom grading strategies, partial credit patterns, answer hints for better student feedback

### Chapter 8: Using AI Agents
- **Relevant files**: All macro POD documentation, `tutorial/sample-problems/` directory structure
- **What to extract**: The POD documentation format in every .pl file provides a machine-readable specification that AI agents can use to generate problems. The sample-problems directory provides 157 working templates organized by topic.
- **Textbook gap it fills**: How AI agents should use PG documentation, common patterns to follow, macro loading conventions

### Chapter 90: Appendices
- **Relevant files**: `lib/Units.pm` (unit definitions), all context files (complete list), `macros/core/PGcommonFunctions.pl`
- **What to extract**: Complete unit catalog from Units.pm, complete context catalog, function reference
- **Textbook gap it fills**: Quick-reference glossary of all available Contexts, all available macros, all MathObject types

## Top 10 Most Useful Files

1. **`macros/core/PGML.pl`** - The PGML parser itself; defines all PGML syntax via regex patterns (answer blanks, math, formatting, lists, code, images)
2. **`macros/parsers/parserRadioButtons.pl`** - Comprehensive radio button MC with randomization, labels, values -- most common question type beyond numeric
3. **`macros/ui/niceTables.pl`** - DataTable/LayoutTable with full accessibility, CSS/LaTeX styling, column alignment -- essential for data display
4. **`macros/graph/PGtikz.pl`** - TikZ image generation with tikzLibraries, tikzOptions, texPackages -- modern graph creation method
5. **`macros/parsers/parserCheckboxList.pl`** - Select-all-that-apply checkbox questions with rich label/randomization options
6. **`macros/parsers/parserPopUp.pl`** - Drop-down menus (PopUp, DropDown, DropDownTF) with placeholder and randomization
7. **`macros/core/scaffold.pl`** - Multi-part scaffolded problems with section visibility control -- critical for complex problems
8. **`macros/contexts/contextReaction.pl`** - Chemical reactions with ions, states, complexes -- essential for science courses
9. **`macros/graph/parserGraphTool.pl`** - Interactive JS graphing tool supporting 12+ object types -- modern interactive question type
10. **`macros/math/draggableProof.pl`** - Drag-and-drop proof ordering with Levenshtein scoring -- unique interactive question type

## Recommended Actions

1. **Add a complete PGML syntax reference** derived from PGML.pl parser regex patterns. The textbook should document every PGML construct: answer blanks (`[_]`, `[^]`, `[o]`, `[x]`), math modes, emphasis, headings, lists (all bullet types including roman/alpha), code blocks, images `[!alt!]{url}`, alignment, command substitution with star variants, variable substitution, line breaks, horizontal rules.

2. **Document all parser macros for question types** not currently in the textbook: `parserRadioMultiAnswer.pl` (radio-dependent answer blanks), `parserOneOf.pl` (multiple valid answers), `parserWordCompletion.pl` (autocomplete), `parserMultiAnswer.pl` (custom multi-answer checkers), `parserGraphTool.pl` (interactive graphing).

3. **Add DraggableProof and DraggableSubsets documentation** from `macros/math/`. These are powerful interactive question types for proof ordering and set partitioning that are not covered in the textbook.

4. **Document science-relevant Contexts**: `contextReaction.pl` (chemistry), `contextBoolean.pl` (logic/CS), `contextBaseN.pl` (CS/math), `contextScientificNotation.pl` (physics), `contextPercent.pl` (statistics), `contextOrdering.pl` (ranking), `contextUnits.pl` (physics).

5. **Add a TikZ and LaTeX image creation guide** from `PGtikz.pl` and `PGlateximage.pl`, covering tikzLibraries, tikzOptions, texPackages, environment settings, and image format options (svg, png, pdf).

6. **Document plotly3D.pl for 3D graphing**: Graph3D(), addCurve(), addFunction(), addSurface() -- this is the modern way to do 3D visualization in WeBWorK.

7. **Add randomPerson.pl documentation** for inclusive problem writing -- demonstrates proper pronoun handling and diverse name representation.

8. **Document answerHints.pl for targeted feedback**: This post-filter is invaluable for providing specific error messages for common wrong answers, partial credit, and guided student feedback.

9. **Create a Contexts quick-reference table** listing all 50 contexts with one-line descriptions, loaded-by macros, and common flags -- essential for problem authors choosing the right context.

10. **Add scaffold.pl multi-part problem patterns** with detailed examples of can_open/is_open options, section dependency management, and integration with essay answers.

11. **Document the 157 sample problems** in `tutorial/sample-problems/` as a reference -- these are organized by topic (Algebra, Misc, ProblemTechniques, Statistics, etc.) and demonstrate canonical patterns for every common problem type.

12. **Add MathObject answer checker options catalog** from `doc/MathObjectsAnswerCheckers.pod`: showTypeWarnings, showEqualErrors, tolerance, tolType, formatStudentAnswer, etc.
