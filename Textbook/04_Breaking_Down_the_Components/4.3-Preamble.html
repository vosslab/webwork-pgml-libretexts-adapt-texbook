<p style="background-color: #dbeafe; padding: 6px 10px;"><strong>Preamble</strong></p>
<p>
The Preamble is the environment setup for the problem. It loads the macro files that make PGML
work and unlocks specific interaction patterns the rest of the file assumes exist. For a reference
list of commonly used macros, see <a href="/@go/page/488659">Section 2.5</a>. For background on
PG files, see <a href="/@go/page/488657">Section 2.3</a>.
</p>
<p>
When a problem fails to load with a generic error, the cause is almost always a missing or
mismatched macro in the preamble. This section is boring when it works and unforgiving when it
does not, so most authors touch it last, not first.
</p>
<h2>How to read this code</h2>
<p>
When reading the preamble, ignore the story of the problem entirely. This section exists to
answer one question only: what tools does this problem need in order to render and grade
correctly. If something fails to load, displays as plain text, or shows missing widgets, the
cause is almost always here.
</p>
<p>
The excerpt below is the exact preamble used in the worked example. It shows the macro files that
are loaded before any values or text are defined.
</p>
<pre>
DOCUMENT();

loadMacros(
	"PGstandard.pl",
	"PGML.pl",
	"parserRadioButtons.pl",
	"PGcourse.pl"
);
</pre>
<p><strong>Line notes</strong></p>
<table class="mt-responsive-table">
	<colgroup>
		<col style="width: 26%;">
		<col style="width: 44%;">
		<col style="width: 30%;">
	</colgroup>
	<thead>
		<tr>
			<th>Line or snippet</th>
			<th>What it does</th>
			<th>What you would change first</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td data-th="Line or snippet"><code>DOCUMENT();</code></td>
			<td data-th="What it does">Initializes the problem file so WeBWorK knows where it begins.</td>
			<td data-th="What you would change first">Almost never changed.</td>
		</tr>
		<tr>
			<td data-th="Line or snippet"><code>PGstandard.pl</code></td>
			<td data-th="What it does">Provides core PG functionality used by nearly all problems.</td>
			<td data-th="What you would change first">Always required.</td>
		</tr>
		<tr>
			<td data-th="Line or snippet"><code>PGML.pl</code></td>
			<td data-th="What it does">Enables PGML formatting and answer blanks.</td>
			<td data-th="What you would change first">Remove only if converting away from PGML.</td>
		</tr>
		<tr>
			<td data-th="Line or snippet"><code>parserRadioButtons.pl</code></td>
			<td data-th="What it does">Enables radio button answer widgets.</td>
			<td data-th="What you would change first">Add or remove when changing interaction type.</td>
		</tr>
		<tr>
			<td data-th="Line or snippet"><code>PGcourse.pl</code></td>
			<td data-th="What it does">Loads course-level helpers and defaults.</td>
			<td data-th="What you would change first">Usually left alone.</td>
		</tr>
	</tbody>
</table>
<p>
A common mistake is copying an example from elsewhere and missing a macro that enables a widget.
When that happens, the problem often renders with no useful error message unless you test locally.
</p>
<p>
Why this exists: it declares which macro files and features the problem can use.
</p>
<table class="mt-responsive-table">
	<colgroup>
		<col style="width: 50%;">
		<col style="width: 50%;">
	</colgroup>
	<thead>
		<tr>
			<th>Common edits</th>
			<th>Common failures</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td data-th="Common edits">
				<ul>
					<li>Add a macro to enable a new interaction.</li>
					<li>Remove a macro that is not used.</li>
				</ul>
			</td>
			<td data-th="Common failures">
				<ul>
					<li>A feature is missing because the macro is not loaded.</li>
					<li>Load order masks a macro or parser option.</li>
				</ul>
			</td>
		</tr>
	</tbody>
</table>

<h2>Macro selection (what to load)</h2>
<table class="mt-responsive-table">
	<colgroup>
		<col style="width: 18%;">
		<col style="width: 22%;">
		<col style="width: 22%;">
		<col style="width: 20%;">
		<col style="width: 18%;">
	</colgroup>
	<thead>
		<tr>
			<th>Macro</th>
			<th>What it enables</th>
			<th>When you need it</th>
			<th>Common failure</th>
			<th>Canonical example</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td data-th="Macro">PGstandard.pl</td>
			<td data-th="What it enables">Core PG functions and helpers.</td>
			<td data-th="When you need it">Always (baseline PG utilities).</td>
			<td data-th="Common failure">Undefined basic functions.</td>
			<td data-th="Canonical example">OpenWeBWorK PG samples: most core examples.</td>
		</tr>
		<tr>
			<td data-th="Macro">PGML.pl</td>
			<td data-th="What it enables">PGML prompt blocks and inserts.</td>
			<td data-th="When you need it">Any PGML-first prompt.</td>
			<td data-th="Common failure">BEGIN_PGML fails or renders raw text.</td>
			<td data-th="Canonical example">OpenWeBWorK PG samples: PGML intro pages.</td>
		</tr>
		<tr>
			<td data-th="Macro">parserRadioButtons.pl</td>
			<td data-th="What it enables">Radio-button answer widgets.</td>
			<td data-th="When you need it">Single-correct multiple choice prompts.</td>
			<td data-th="Common failure">Radio buttons do not render.</td>
			<td data-th="Canonical example">OpenWeBWorK PG samples: radio button techniques.</td>
		</tr>
		<tr>
			<td data-th="Macro">PGcourse.pl</td>
			<td data-th="What it enables">Course macros and shared helpers.</td>
			<td data-th="When you need it">You rely on course-wide helpers.</td>
			<td data-th="Common failure">Custom helper not found.</td>
			<td data-th="Canonical example">OpenWeBWorK PG samples: course macro usage.</td>
		</tr>
	</tbody>
</table>

<p>
For radio-button interactions, load <code>parserRadioButtons.pl</code> and mirror the official
radio button technique pages in the OpenWeBWorK PG samples so the UI matches the pattern you want.
</p>

<p>
Useful reference samples include parserMultiAnswer and NumericalTolerance in the OpenWeBWorK PG
samples, which show canonical patterns for coordinated blanks and tolerance handling when you
move beyond single-choice prompts.
</p>

<p>
Some older examples use legacy macros or interaction widgets that still appear online; prefer the
patterns shown in the official PG sample problems when choosing an interaction style.
</p>

<h2>When it breaks</h2>
<table class="mt-responsive-table">
	<colgroup>
		<col style="width: 28%;">
		<col style="width: 36%;">
		<col style="width: 36%;">
	</colgroup>
	<thead>
		<tr>
			<th>Symptom</th>
			<th>Likely cause</th>
			<th>Fix</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td data-th="Symptom">Macro not found error</td>
			<td data-th="Likely cause">Missing macro file in <code>loadMacros()</code>.</td>
			<td data-th="Fix">Add the macro and keep load order consistent.</td>
		</tr>
		<tr>
			<td data-th="Symptom">Choice widget renders as plain text</td>
			<td data-th="Likely cause">Radio button macro file not loaded.</td>
			<td data-th="Fix">Load <code>parserRadioButtons.pl</code> in the Preamble.</td>
		</tr>
		<tr>
			<td data-th="Symptom">PGML block not recognized</td>
			<td data-th="Likely cause">Missing <code>PGML.pl</code>.</td>
			<td data-th="Fix">Load <code>PGML.pl</code> before the PGML block.</td>
		</tr>
	</tbody>
</table>

<h2>Broken example: missing macro for the interaction</h2>
<p>
This problem fails before the statement even renders. The author copied a radio button example
but did not load the macro that provides the widget. In ADAPT, this often appears as a generic
error with no line number.
</p>
<pre>
DOCUMENT();

loadMacros(
	"PGstandard.pl",
	"PGML.pl",
	"PGcourse.pl"
);
</pre>
<p>
Later in the file, the setup uses <code>RadioButtons</code>.
</p>
<p><strong>What went wrong</strong></p>
<ul>
	<li>The interaction widget exists in setup, but the macro that defines it was never loaded.</li>
	<li>The PG file parses, but rendering fails when the widget is encountered.</li>
	<li>ADAPT typically reports a generic error loading the problem.</li>
</ul>
<p><strong>How to recognize it</strong></p>
<ul>
	<li>The file worked in another problem you copied from.</li>
	<li>The error appears before any text renders.</li>
	<li>Local rendering reports an undefined subroutine or missing macro.</li>
</ul>
<p><strong>How to fix it</strong></p>
<p>
Add the missing macro to <code>loadMacros()</code> and re-render immediately. This is why preamble
problems should always be tested locally before import.
</p>
